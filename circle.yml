general:
  branches:
    only:
      - source
    ignore:
      - master

machine:
  timezone:
    Europe/Warsaw
  environment:
    NOKOGIRI_USE_SYSTEM_LIBRARIES: true # speeds up installation of html-proofer

dependencies:
  pre:
    - npm install -g tree-cli
    - gem install bundler -v 1.16.1
  post:
    - bundle exec jekyll build

test:
  post:
    - treee -l 10
    - bundle exec htmlproofer ./Output --check-html --check-favicon --allow-hash-href --assume-extension --disable-external

deployment:
  build:
    branch: source
    commands:
      - bash "./CircleCI build.sh"
